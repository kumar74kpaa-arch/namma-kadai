/**
 * @file Firestore Security Rules for Namma Kadai Application
 *
 * @core_philosophy This ruleset enforces a role-based access control (RBAC) model where only authenticated admin users have full CRUD access to the `products` and `orders` collections. Anonymous users can only read these collections. This ensures that only authorized personnel can manage the product catalog and customer orders, while still allowing public read access.
 * @data_structure The data is organized into two top-level collections: `/products/{productId}` and `/orders/{orderId}`.
 * @key_security_decisions
 *   - Public Read Access: The `get` and `list` operations are open to the public for both the `products` and `orders` collections.
 *   - Admin-Only Writes: The `create`, `update`, and `delete` operations are restricted to authenticated users (assumed to be admins).
 *   - No User Listing: Listing users is not supported in this ruleset.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows public read access to products and restricts write access to authenticated users.
     * @path /products/{productId}
     * @allow (get, list) - Any user can read product information.
     * @allow (create, update, delete) - Authenticated user can create, update, and delete product.
     * @deny (create, update, delete) - Unauthenticated user attempts to create, update, or delete a product.
     * @principle Enforces role-based access control, allowing public read access but restricting write access to authenticated users.
     */
    match /products/{productId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows public read access to orders and restricts write access to authenticated users.
     * @path /orders/{orderId}
     * @allow (get, list) - Any user can read order information.
     * @allow (create, update, delete) - Authenticated user can create, update, and delete order.
     * @deny (create, update, delete) - Unauthenticated user attempts to create, update, or delete a order.
     * @principle Enforces role-based access control, allowing public read access but restricting write access to authenticated users.
     */
    match /orders/{orderId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    function isSignedIn() {
      return request.auth != null;
    }
  }
}